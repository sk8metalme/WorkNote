# Phase 3: E2E テスト計画

## 概要

Phase 3（AI文章添削機能）のE2Eテスト計画です。

## テスト環境

### 前提条件

1. **Tauriアプリケーション**: 本番ビルドまたは開発ビルドを起動
2. **Claude CLI**: システムにインストール済み
3. **テストフレームワーク**: WebDriver / Playwright（将来実装）

### テストデータ

- 正常系: 100文字程度のMarkdownテキスト
- 異常系:
  - 空文字列
  - 10,000文字超過
  - 特殊文字を含むテキスト

## テストケース

### TC-E2E-001: DetailInputWindow - AI添削機能（正常系）

**目的**: AI添削機能が正常に動作することを確認

**前提条件**:
- DetailInputWindowが開いている
- Claude CLIがインストールされている

**テスト手順**:
1. 「症状」フィールドに以下のテキストを入力:
   ```
   サーバーがダウンしています。
   エラーログを確認してください
   ```
2. 「AI添削」ボタンをクリック
3. 添削が完了するまで待機（ローディング表示を確認）
4. DiffViewerモーダルが表示されることを確認
5. 差分が適切に表示されることを確認（赤/緑のハイライト）
6. 「すべて受け入れる」ボタンをクリック
7. モーダルが閉じることを確認
8. 「症状」フィールドが添削後のテキストに更新されることを確認

**期待結果**:
- 添削が成功し、差分が適切に表示される
- 受け入れボタンで元のフィールドが更新される

---

### TC-E2E-002: DetailInputWindow - AI添削機能（却下）

**目的**: 添削結果を却下できることを確認

**前提条件**:
- DetailInputWindowが開いている
- Claude CLIがインストールされている

**テスト手順**:
1. 「対応手順」フィールドに任意のテキストを入力
2. 「AI添削」ボタンをクリック
3. DiffViewerモーダルが表示されるまで待機
4. 「すべて却下する」ボタンをクリック
5. モーダルが閉じることを確認
6. 「対応手順」フィールドが元のテキストのままであることを確認

**期待結果**:
- 却下ボタンでモーダルが閉じる
- 元のフィールドは変更されない

---

### TC-E2E-003: DetailInputWindow - AI添削エラー（空文字列）

**目的**: 空文字列の添削でエラーが適切に処理されることを確認

**前提条件**:
- DetailInputWindowが開いている

**テスト手順**:
1. 「注意点・落とし穴」フィールドを空のままにする
2. 「AI添削」ボタンをクリック

**期待結果**:
- アラートが表示される: "添削する文章を入力してください"

---

### TC-E2E-004: DetailInputWindow - AI添削エラー（CLI未インストール）

**目的**: Claude CLIが未インストールの場合のエラーハンドリングを確認

**前提条件**:
- DetailInputWindowが開いている
- Claude CLIがインストールされていない（または一時的にリネーム）

**テスト手順**:
1. 任意のフィールドにテキストを入力
2. 「AI添削」ボタンをクリック

**期待結果**:
- エラーダイアログが表示される
- エラーメッセージに以下の内容が含まれる:
  - "Claude CLI が見つかりません"
  - インストール手順のURL

---

### TC-E2E-005: DetailInputWindow - 長文テキストの添削

**目的**: 10,000文字の制限が適切に機能することを確認

**前提条件**:
- DetailInputWindowが開いている

**テスト手順**:
1. 「対応手順」フィールドに10,001文字のテキストを入力
2. 「AI添削」ボタンをクリック

**期待結果**:
- エラーダイアログが表示される
- エラーメッセージに以下の内容が含まれる:
  - "Content is too long"
  - "Maximum 10000 characters allowed"

---

### TC-E2E-006: DiffViewer - 複数行の差分表示

**目的**: 複数行の差分が適切に表示されることを確認

**前提条件**:
- DetailInputWindowが開いている
- Claude CLIがインストールされている

**テスト手順**:
1. 「症状」フィールドに以下のテキストを入力:
   ```
   1. サーバーがダウン
   2. データベースエラー
   3. ネットワーク遅延
   ```
2. 「AI添削」ボタンをクリック
3. DiffViewerモーダルを確認

**期待結果**:
- 各行の差分が適切に表示される
- 追加行は緑色でハイライト
- 削除行は赤色でハイライト
- 変更なしの行は通常色で表示

---

## テスト実行環境

### 手動テスト（現在）

現時点では、上記のテストケースを手動で実行します。

**実行手順**:
1. Tauriアプリをビルド: `npm run tauri build`
2. アプリを起動
3. 各テストケースを順番に実行
4. 結果を記録

### 自動E2Eテスト（将来実装）

以下のツールを使用した自動E2Eテストの実装を検討:

**候補ツール**:
- **WebDriver**: Tauri公式サポート
- **Playwright**: Web UI自動化
- **Tauri Testing Library**: Tauri専用テストライブラリ

**実装タスク**:
1. WebDriverセットアップ
2. テストフレームワーク設定（Jest / Vitest）
3. Claude CLIのモック化
4. テストスクリプト作成
5. CI/CD統合

## テスト実行記録

### 2026-02-01: Phase 3 初回実装

**実行者**: （自動化前のため未実行）

**結果**:
- TC-E2E-001: ⏸️ 未実行（手動テスト待ち）
- TC-E2E-002: ⏸️ 未実行（手動テスト待ち）
- TC-E2E-003: ⏸️ 未実行（手動テスト待ち）
- TC-E2E-004: ⏸️ 未実行（手動テスト待ち）
- TC-E2E-005: ⏸️ 未実行（手動テスト待ち）
- TC-E2E-006: ⏸️ 未実行（手動テスト待ち）

**備考**:
- Phase 3の実装完了
- 単体テスト: ✅ 35 passed; 0 failed
- 警告: ✅ 0件
- E2Eテストは手動テストまたは将来の自動化を待つ

---

## 付録: テスト自動化の参考資料

- [Tauri Testing Guide](https://tauri.app/v1/guides/testing/)
- [WebDriver for Tauri](https://tauri.app/v1/guides/testing/webdriver/)
- [Playwright Documentation](https://playwright.dev/)
