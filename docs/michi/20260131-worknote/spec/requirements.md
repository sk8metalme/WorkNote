# 要件定義書: WorkNote

## プロジェクト概要

### プロダクト情報

| 項目 | 内容 |
|------|------|
| **プロジェクト名** | WorkNote (20260131-worknote) |
| **アプリケーション名** | WorkNote.app |
| **プラットフォーム** | macOS 12 (Monterey) 以降 |
| **種別** | ネイティブデスクトップアプリケーション |
| **目的** | 運用ナレッジを素早く入力し、Gitリポジトリに自動集約する |
| **ソース** | [GitHub Issue #1](https://github.com/sk8metalme/WorkNote/issues/1) |

### コンセプト

```
「思いついた時に、サッと記録。自動でチームに共有。」
```

- **AI生成を待たない** — 人間のタイピング速度で即完了
- **フォーム入力で統一フォーマット** — 誰が書いても同じ構造
- **Git連携で自動集約** — 保存ボタンでチーム共有完了

### 位置づけ

WorkNoteは、Claude Codeスキルとの並列経路として位置づけられます：

- **WorkNote（直接入力）**: 内容が明確な時、サクッと登録したい時
- **Claude Code + skill（会話型）**: 対応しながら記録したい時、整理を手伝って欲しい時

両方とも同じフォーマット・同じ場所にナレッジが集まる設計です。

---

## 技術スタック

### 採用技術

| カテゴリ | 技術 | バージョン | 選定理由 |
|----------|------|------------|----------|
| **フレームワーク** | Tauri | v2 | 軽量（5-10MB）、高速起動、Web技術で開発可 |
| **フロントエンド** | Svelte | 4+ | シンプルな構文、高速レンダリング |
| **型システム** | TypeScript | 5+ | 型安全性、IDE支援 |
| **スタイリング** | Tailwind CSS | 3+ | ユーティリティファースト、迅速なUI開発 |
| **バックエンド** | Rust | 1.70+ | 安全性、パフォーマンス、Git操作 |

### 依存ライブラリ

| カテゴリ | ライブラリ | 用途 |
|----------|------------|------|
| UIアイコン | Lucide Icons | アイコン表示 |
| フォーム | Svelte Forms | バリデーション |
| Git操作 | Rust std::process | コマンド実行 |
| 設定保存 | tauri-plugin-store | ローカル設定永続化 |
| ショートカット | tauri-plugin-global-shortcut | グローバルホットキー |

---

## EARS形式要件定義

### 機能要件（Functional Requirements）

#### FR-001: Spotlight風クイック入力ウィンドウ

**種類**: Event-driven
**要件**: グローバルショートカット（デフォルト: `⌘ + Shift + K`）が押下された場合、システムはSpotlight風の小さな入力ウィンドウを画面中央上部に表示すること
**優先度**: 🔴 必須（Phase 2）
**受入条件**:
- ウィンドウサイズ: 480px × 280px（固定）
- 表示位置: 画面中央上部
- 起動時にタイトル入力欄にフォーカス
- Escキーでウィンドウを閉じる
- 起動時間: 0.3秒以内

#### FR-002: 詳細入力ウィンドウ

**種類**: Ubiquitous
**要件**: システムは常にフル機能の詳細入力フォームを提供すること
**優先度**: 🔴 必須（Phase 1）
**受入条件**:
- 以下のフィールドを含むこと:
  - タイトル（必須、1-100文字）
  - カテゴリ（必須、alerts/maintenance/troubleshooting）
  - 重要度（必須、low/medium/high/critical）
  - 症状・検知条件（任意、最大5000文字）
  - 対応手順（任意、最大10000文字、Markdown対応）
  - 注意点・落とし穴（任意、最大3000文字）
  - 関連リンク（任意、最大1000文字）
- ウィンドウサイズ: 初期720px × 800px、最小600px × 600px
- リサイズ可能

#### FR-003: 入力バリデーション

**種類**: Ubiquitous
**要件**: システムは常に入力値のバリデーションを実行すること
**優先度**: 🔴 必須（Phase 1）
**受入条件**:
- タイトル: 1-100文字、空白のみは不可
- カテゴリ: 選択肢から必須選択
- 重要度: 選択肢から必須選択
- 文字数制限を超えた場合はエラー表示
- エラーメッセージは各フィールドの下に表示

#### FR-004: Markdownプレビュー

**種類**: Optional
**要件**: 必要に応じて、システムは入力内容のMarkdownプレビューを表示してもよい
**優先度**: 🟡 重要（Phase 2）
**受入条件**:
- プレビュー表示チェックボックスでON/OFF切替
- チェック時、ウィンドウ右側にプレビューペインを表示
- リアルタイムで入力内容を反映

#### FR-005: Git直接Pushモード

**種類**: Event-driven
**要件**: 「Git Commit & Push」ボタンがクリックされた場合、システムは以下の処理を実行すること
**優先度**: 🔴 必須（Phase 1）
**受入条件**:
1. 入力内容からMarkdownファイルを生成
2. ローカルリポジトリの状態確認（`git status`）
3. デフォルトブランチを最新化（`git pull`）
4. ファイル追加・コミット（`git add` + `git commit`）
5. リモートにプッシュ（`git push`）
6. 完了通知を表示

**コミットメッセージフォーマット**:
```
docs(worknote): add {title}

Created by WorkNote
Category: {category}
Severity: {severity}
```

#### FR-006: Git PR作成モード

**種類**: Event-driven
**要件**: 設定で「PR作成モード」が選択されている場合、システムはfeatureブランチを作成してプッシュすること
**優先度**: 🔴 必須（Phase 2）
**受入条件**:
1. デフォルトブランチから最新を取得
2. `feature/worknote-{title}-{timestamp}` ブランチを作成
3. ファイル追加・コミット
4. featureブランチをプッシュ
5. PR作成用URLを通知に表示

#### FR-007: リポジトリ設定

**種類**: Ubiquitous
**要件**: システムは常にGitリポジトリの設定を管理できること
**優先度**: 🔴 必須（Phase 1）
**受入条件**:
- 設定可能な項目:
  - リポジトリパス（ディレクトリ選択）
  - ナレッジ保存先（リポジトリ内相対パス）
  - デフォルトブランチ（デフォルト: main）
  - コミットモード（直接Push / PR作成）
  - Author名
  - Authorメールアドレス
- 設定は `~/Library/Application Support/WorkNote/config.json` に保存
- 設定画面は `⌘ + ,` で起動

#### FR-008: 下書き保存

**種類**: Optional
**要件**: 必要に応じて、システムは入力途中の内容をローカルに保存してもよい
**優先度**: 🟡 重要（Phase 3）
**受入条件**:
- `⌘ + S` で下書き保存
- 保存先: `~/Library/Application Support/WorkNote/drafts/{uuid}.json`
- 下書き一覧から復元可能

#### FR-009: グローバルショートカット

**種類**: Event-driven
**要件**: グローバルショートカットが設定されている場合、システムはそのキーでクイック入力ウィンドウを起動すること
**優先度**: 🟡 重要（Phase 2）
**受入条件**:
- デフォルト: `⌘ + Shift + K`
- 設定画面でカスタマイズ可能
- 他のアプリがフォアグラウンドでも動作

#### FR-010: Markdownファイル生成

**種類**: Ubiquitous
**要件**: システムは常に入力内容から以下の形式でMarkdownファイルを生成すること
**優先度**: 🔴 必須（Phase 1）
**受入条件**:
- ファイル名: タイトルをkebab-caseに変換（例: "CPU高騰対応" → "cpu-gao-teng-dui-ying.md"）
- 保存先: `{リポジトリパス}/{ナレッジ保存先}/{カテゴリ}/{filename}.md`
- frontmatter（YAML形式メタデータ）を含む
- 以下のセクション構成:
  - タイトル
  - 概要
  - 症状・検知条件
  - 対応手順
  - 注意点・落とし穴
  - 関連リンク
  - 対応履歴

---

### 非機能要件（Non-Functional Requirements）

#### NFR-001: パフォーマンス

**種類**: Ubiquitous
**要件**: システムは常に以下のパフォーマンス基準を満たすこと
**優先度**: 🔴 必須
**受入条件**:
- アプリ起動時間: 1秒以内
- Spotlight風ウィンドウ表示: 0.3秒以内
- メモリ使用量（アイドル時）: 50MB以下
- メモリ使用量（入力時）: 100MB以下
- アプリサイズ: 15MB以下

#### NFR-002: 対応環境

**種類**: Ubiquitous
**要件**: システムは常に以下の環境で動作すること
**優先度**: 🔴 必須
**受入条件**:
- OS: macOS 12 (Monterey) 以降
- アーキテクチャ: Apple Silicon (arm64) / Intel (x86_64)
- 前提ソフトウェア: Git（コマンドライン）

#### NFR-003: セキュリティ

**種類**: Unwanted
**要件**: システムはGit認証情報をアプリ内に保存してはならない
**優先度**: 🔴 必須
**受入条件**:
- Git認証はOS/ツール（SSH鍵、Credential Helper）に委譲
- 設定ファイルはユーザー権限でのみアクセス可能
- ネットワーク通信はGit操作のみ（直接通信なし）

#### NFR-004: ユーザビリティ

**種類**: Ubiquitous
**要件**: システムは常に直感的で操作しやすいUIを提供すること
**優先度**: 🟡 重要
**受入条件**:
- Tabキーで入力欄を順次移動
- Enterキーで保存実行（Spotlight風）
- `⌘ + Enter` で保存実行（詳細入力）
- Escキーでウィンドウを閉じる
- エラーメッセージは具体的で対処方法を示す

#### NFR-005: 保守性

**種類**: Ubiquitous
**要件**: システムは常に保守しやすいコード構造を維持すること
**優先度**: 🟡 重要
**受入条件**:
- TypeScriptによる型安全性
- Rustによるバックエンドの安全性
- コンポーネント単位でのテスト
- 設定ファイルのバージョニング

---

### 制約条件（Constraints）

#### CON-001: Git依存

**制約**: システムはGitコマンドラインツールに依存する
**理由**: 軽量化のため、libgit2等のライブラリを使用しない
**影響**: Git未インストール環境では動作しない（初回起動時に案内）

#### CON-002: macOS専用

**制約**: 初期バージョンはmacOSのみ対応
**理由**: 開発リソースの集中、チームの利用環境に合致
**影響**: Windows/Linux版は将来的な拡張として検討

#### CON-003: ファイルベース管理

**制約**: ナレッジはMarkdownファイルとしてGitリポジトリで管理
**理由**: シンプルさ、バージョン管理、テキスト検索の容易さ
**影響**: データベースのような高度な検索機能は提供しない

#### CON-004: ネットワーク必須（Push時）

**制約**: Git pushにはネットワーク接続が必要
**理由**: リモートリポジトリへの送信
**影響**: オフライン時はPushに失敗（下書き保存で対応）

---

## リスク分析

### 技術的リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| Git認証エラーでPush失敗 | 高 | 中 | エラー表示で設定手順を案内、下書き保存で損失を防ぐ |
| ファイル名衝突 | 中 | 低 | タイムスタンプ付加 or 上書き確認ダイアログ |
| ネットワーク障害 | 中 | 中 | リトライ選択肢、下書き保存 |
| コンフリクト発生 | 中 | 低 | エラー表示で手動解決を案内 |
| Tauri v2の変更 | 低 | 低 | 安定版リリース後に開発開始 |

### 運用リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| ユーザーがGit設定に不慣れ | 中 | 高 | 初回起動時にウィザード形式でガイド |
| ブランチ戦略の不一致 | 低 | 中 | 直接Push/PR作成の選択肢を提供 |
| ナレッジの重複作成 | 低 | 中 | 将来的に検索機能で対応 |

---

## 開発フェーズ

### Phase 1: MVP（最小機能）

**目標**: 基本的なナレッジ入力→Git pushが動作する状態

| 機能 | 要件ID |
|------|--------|
| 詳細入力ウィンドウ | FR-002 |
| 入力バリデーション | FR-003 |
| Git直接Pushモード | FR-005 |
| リポジトリ設定 | FR-007 |
| Markdownファイル生成 | FR-010 |

**完了基準**:
- タイトル、カテゴリ、重要度を入力してMarkdownファイルを生成できる
- Git commit & pushが成功する
- エラー時に適切なメッセージが表示される

### Phase 2: 使いやすさ向上

**目標**: 日常的に使いやすい状態

| 機能 | 要件ID |
|------|--------|
| Spotlight風クイック入力 | FR-001 |
| Git PR作成モード | FR-006 |
| Markdownプレビュー | FR-004 |
| グローバルショートカット | FR-009 |

**完了基準**:
- グローバルショートカットでクイック入力が起動
- PR作成モードで自動的にfeatureブランチを作成
- プレビューで出力を確認できる

### Phase 3: 拡張機能

**目標**: 完全な機能セット

| 機能 | 要件ID |
|------|--------|
| 下書き保存・復元 | FR-008 |
| 作成履歴表示 | 未定義 |
| カスタムテンプレート | 未定義 |
| メニューバー常駐 | 未定義 |

**完了基準**:
- 下書きを保存・復元できる
- 過去に作成したナレッジを一覧表示できる
- カスタムテンプレートを追加・編集できる

---

## 参照

### マスタードキュメント

現時点ではマスタードキュメントは存在しませんが、将来的に以下を作成予定：
- `docs/master-docs/structure.md` - システム構造
- `docs/master-docs/tech.md` - 技術スタック
- `docs/master-docs/product.md` - プロダクト要件

### 関連ドキュメント

- [GitHub Issue #1](https://github.com/sk8metalme/WorkNote/issues/1) - 元の要件定義
- `docs/michi/20260131-worknote/spec/design.md` - 設計書（次のステップで作成）
- `docs/michi/20260131-worknote/test-plan/test-plan.md` - テスト計画（後続で作成）

---

## 付録

### A. 用語定義

| 用語 | 定義 |
|------|------|
| Runbook | 運用手順書。アラート対応、保守作業、障害対応の手順を記載 |
| frontmatter | Markdownファイル冒頭のYAML形式メタデータ |
| kebab-case | 単語をハイフンで繋ぐ命名規則（例: my-file-name） |
| EARS | Easy Approach to Requirements Syntax - 要件記述の標準形式 |

### B. EARS形式テンプレート

要件記述時の参考：

- **Ubiquitous**: システムは常に〜すること
- **Event-driven**: 〜の場合、システムは〜すること
- **State-driven**: 〜の状態において、システムは〜すること
- **Optional**: 必要に応じて、システムは〜してもよい
- **Unwanted**: 〜の場合、システムは〜してはならない

### C. ショートカット一覧

| ショートカット | 動作 | 画面 |
|----------------|------|------|
| `⌘ + Shift + K` | クイック入力起動 | グローバル |
| `⌘ + Enter` | 保存実行 | 入力画面 |
| `⌘ + S` | 下書き保存 | 入力画面 |
| `⌘ + P` | プレビュー切替 | 詳細入力 |
| `⌘ + ,` | 設定画面を開く | 全画面 |
| `Esc` | ウィンドウを閉じる | 入力画面 |

---

**文書情報**

| 項目 | 内容 |
|------|------|
| 作成日 | 2026-01-31 |
| 作成者 | Claude Code (michi:create-requirements) |
| バージョン | 1.0 |
| ステータス | 承認待ち |
| フェーズ | requirements-generated |
